#!/bin/sh

set -eu

if [ $# -ne 2 ]; then
    echo "usage: $(basename "$0") type name" >&2
    exit 64
fi

keytype="$1"
keyname="$2"
keyid=id_"$keytype"_"$keyname"

mkdir -p -m 700 $HOME/.ssh/keys

if [ "$keytype" = ed25519 ]; then
    ssh-keygen -t "$keytype" -C "$keyid" -f $HOME/.ssh/keys/"$keyid"
elif [ "$keytype" = rsa ]; then
    ssh-keygen -t "$keytype" -b 4096 -C "$keyid" -f $HOME/.ssh/keys/"$keyid"
else
    echo "$(basename "$0"): unknown key type '$keytype'" >&2
    exit 64
fi

chmod 600 $HOME/.ssh/keys/"$keyid" $HOME/.ssh/keys/"$keyid".pub
