#!/bin/sh

set -eu

if [ $# -ne 2 ]; then
    echo "usage: $(basename "$0") type name" >&2
    exit 64
fi

readonly keytype="$1"
readonly keyname="$2"
readonly keyid=id_"$keytype"_"$(hostname -s)"_"$keyname"

mkdir -p ~/.ssh/keys
chmod 700 ~/.ssh ~/.ssh/keys

if [ "$keytype" = ed25519 ]; then
    ssh-keygen -t "$keytype" -C "$keyid" -f ~/.ssh/keys/"$keyid"
elif [ "$keytype" = rsa ]; then
    ssh-keygen -t "$keytype" -b 4096 -C "$keyid" -f ~/.ssh/keys/"$keyid"
else
    echo "$(basename "$0"): unknown key type '$keytype'" >&2
    exit 64
fi

chmod 600 ~/.ssh/keys/"$keyid" ~/.ssh/keys/"$keyid".pub
